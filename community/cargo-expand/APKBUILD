# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
maintainer="Matthias Ahouansou <matthias@ahouansou.cz>"
pkgname=cargo-expand
pkgver=1.0.116
pkgrel=0
pkgdesc="Cargo subcommand to show result of macro expansion"
url="https://github.com/dtolnay/cargo-expand"
arch="all"
license="MIT OR Apache-2.0"
makedepends="cargo-auditable"
depends="cargo"
subpackages="$pkgname-doc"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/dtolnay/cargo-expand/archive/refs/tags/$pkgver.tar.gz
	bump-rustix.patch
"
options="net"

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

check() {
	cargo test --frozen
}

package() {
	install -Dm 755 target/release/cargo-expand "$pkgdir"/usr/bin/cargo-expand

	for l in APACHE MIT
	do
		install -Dm 644 LICENSE-"$l" "$pkgdir"/usr/share/licenses/"$pkgname"/LICENSE-"$l"
	done
}

sha512sums="
c2c4cc8a4e9ab3801d8116e356517110c303259e958b76e3dc4e6f702164f5cf50a999406da88a9b088bffc83a911396ad89afe2ea7317369e1c7f4e3d81b8d7  cargo-expand-1.0.116.tar.gz
83ac48a11ac2e119ce58d59b5c879405f910028a17f70a22cc874a489d89574ddf2f6e4fe48dd92bbdc50045b20dee132417fb648af6845b8513a18c60ba3054  bump-rustix.patch
"
