From b0d3dbe3f0b89700fb1df44a7f65dadf164ff558 Mon Sep 17 00:00:00 2001
From: Sertonix <sertonix@posteo.net>
Date: Sat, 10 May 2025 19:32:04 +0200
Subject: [PATCH] abuild: do not export tmpdir/pkgbasedir

Ref 751870231aff abuild: do not export "$srcdir"
---
 abuild.in | 13 ++++++++-----
 1 file changed, 8 insertions(+), 5 deletions(-)

diff --git a/abuild.in b/abuild.in
index 8bd7472d9cf..ffcd9f1a03e 100644
--- a/abuild.in
+++ b/abuild.in
@@ -2585,7 +2585,13 @@ rootbld() {
 		"$BUILD_ROOT/tmp/tmp" "$BUILD_ROOT/usr/bin" \
 		"$REPODEST" "$BUILD_ROOT/$HOME/.ccache"
 
-	cp /etc/abuild.conf "$BUILD_ROOT/etc"
+	# Avoid exporting {src,pkgbase,tmp}dir
+	cat - /etc/abuild.conf <<-EOF > "$BUILD_ROOT"/etc/abuild.conf
+		srcdir=/tmp/src
+		pkgbasedir=/tmp/pkg
+		tmpdir=/tmp/tmp
+
+	EOF
 
 	local dir
 	for dir in /usr/share/apk/keys/$CBUILD_ARCH /etc/apk/keys; do
@@ -2683,9 +2689,6 @@ rootbld() {
 		--hostname "build-$buildhost-$CARCH" \
 		--chdir "$startdir" \
 		--clearenv \
-		--setenv abuild_srcdir /tmp/src \
-		--setenv pkgbasedir /tmp/pkg \
-		--setenv tmpdir /tmp/tmp \
 		--setenv CARCH "$CARCH" \
 		--setenv HOME "$HOME" \
 		--setenv REPODEST "$REPODEST" \
@@ -3006,7 +3009,7 @@ fi
 APKBUILD=$(readlink -f "$APKBUILD")
 
 startdir="${APKBUILD%/*}"
-srcdir=${srcdir:-${abuild_srcdir:-"$startdir/src"}}
+srcdir=${srcdir:-"$startdir/src"}
 pkgbasedir=${pkgbasedir:-"$startdir/pkg"}
 tmpdir=${tmpdir:-"$startdir/tmp"}
 
-- 
2.51.0

