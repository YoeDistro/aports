From 6c3458a8b7ee7d39f070c7b2350851cb2110c65a Mon Sep 17 00:00:00 2001
From: Alan Modra <amodra@gmail.com>
Date: Tue, 1 Apr 2025 22:36:54 +1030
Subject: [PATCH] PR32829, SEGV on objdump function debug_type_samep

u.kenum is always non-NULL, see debug_make_enum_type.

	PR 32829
	* debug.c (debug_type_samep): Correct incomplete enum test.
	(debug_write_type): Remove dead code.
---
 binutils/debug.c | 9 +++------
 1 file changed, 3 insertions(+), 6 deletions(-)

diff --git a/binutils/debug.c b/binutils/debug.c
index dcc8ccde4c5..465b18e7c0a 100644
--- a/binutils/debug.c
+++ b/binutils/debug.c
@@ -2554,9 +2554,6 @@ debug_write_type (struct debug_handle *info,
     case DEBUG_KIND_UNION_CLASS:
       return debug_write_class_type (info, fns, fhandle, type, tag);
     case DEBUG_KIND_ENUM:
-      if (type->u.kenum == NULL)
-	return (*fns->enum_type) (fhandle, tag, (const char **) NULL,
-				  (bfd_signed_vma *) NULL);
       return (*fns->enum_type) (fhandle, tag, type->u.kenum->names,
 				type->u.kenum->values);
     case DEBUG_KIND_POINTER:
@@ -3097,9 +3094,9 @@ debug_type_samep (struct debug_handle *info, struct debug_type_s *t1,
       break;
 
     case DEBUG_KIND_ENUM:
-      if (t1->u.kenum == NULL)
-	ret = t2->u.kenum == NULL;
-      else if (t2->u.kenum == NULL)
+      if (t1->u.kenum->names == NULL)
+	ret = t2->u.kenum->names == NULL;
+      else if (t2->u.kenum->names == NULL)
 	ret = false;
       else
 	{
-- 
2.43.7
